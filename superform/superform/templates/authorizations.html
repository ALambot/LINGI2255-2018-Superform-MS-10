{% extends "layout.html" %}
{% block title %}Authorizations{% endblock %}
{% block content %}
    <h1>Authorizations</h1>
    <div id="accordion">
        {% for channel in rw_channels %}
            <div class="card mb-2">
                <div class="card-header" id="heading{{ loop.index }}">
                    <h5 class="mb-0">
                        <i class="fas fa-fw fa-chevron-right"></i>
                        <button type=button class="btn btn-link" data-toggle="collapse" data-target="#collapse{{ loop.index }}" aria-expanded="true" aria-controls="collapseOne">
                            {{ channel.name }}
                        </button>
                    </h5>
                </div>
                <div id="collapse{{ loop.index }}" class="collapse" aria-labelledby="heading{{ loop.index }}" data-parent="#accordion">
                    <div class="card-body p-0">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Person</th>
                                    <th>Permission</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for authorization in channel.authorizations %}
                                    {% set is_session_user = authorization.user_id == session["user_id"] %}
                                    <tr>
                                        <td>
                                            {% set user = authorization.user %}
                                            {{ user.first_name }} {{ user.name }} [{{ user.id }}]
                                        </td>
                                        <td>
                                            <select class="form-control" id="sel1" {{ 'disabled' if is_session_user else '' }}>
                                                {% for permission in permissions %}
                                                    <option value="{{ permission.value }}" {{ 'selected' if authorization.permission == permission.value else '' }}>{{ permission }}</option>
                                                {% endfor %}
                                            </select>
                                        </td>
                                        <td>
                                            {% if not is_session_user %}
                                                <button class="btn btn-danger">Delete</button>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                <tr>
                                    <td>
                                        <input class="form-control" type="text" placeholder="Username">
                                    </td>
                                    <td>
                                        <select class="form-control" id="sel1">
                                            {% for permission in permissions %}
                                                <option value="{{ permission.value }}">{{ permission }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td>
                                        <button class="add btn btn-success">Add</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    <button class="btn btn-warning">Update</button>
{% endblock %}
{% block scripts %}
    <script>
        $('.collapse').on('show.bs.collapse hide.bs.collapse', function () {
            $(this).parent().find('i').toggleClass('fa-chevron-right').toggleClass('fa-chevron-down');
        });

        function remove(e){
           $(e).parent().parent().remove();
        }

        $('.add').on('click',function(){
           $(this).parent().parent().parent().append('<tr><td><input class="form-control" type="text" placeholder="Username"></td><td><select class="form-control" id="sel1">\n' +
               '{% for permission in permissions %}\n'+
                   '<option value="{{ permission.value }}">{{ permission }}</option>\n'
                   +
                   '{% endfor %}\n' +
               '</select></td><td><button class="remove btn btn-warning" onclick="remove(this)">Remove</button></td></tr>');
        });




    </script>
{% endblock %}