{% extends "layout.html" %}
{% block title %}New Post{% endblock %}
{% block content %}
    <h1>New Post</h1>
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#home">General</a>
      </li>
      {% for chan in l_chan %}
          <li class="nav-item" id="li_{{ chan.name }}" style="display:none;">
            <a class="nav-link" data-toggle="tab" href="#menu{{ chan.id }}">{{ chan.name }}</a>
          </li>
     {% endfor %}
    </ul>
    {% if session.logged_in %}
        <p>{{ user }}</p>
        <form method="POST" action="">
            <div class="tab-content">
              <div class="tab-pane container-fluid active" id="home">

                <div class="row">
                    <div class="col-md-8">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="titlepost">Title</label><br>
                                    <input type="text" name="titlepost" id="titlepost" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="descriptionpost">Description</label><br>
                                    <textarea class="form-control" rows="5" id="descriptionpost" name="descriptionpost"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="linkurlpost">Link</label><br>
                                    <input type="text" name="linkurlpost" id="linkurlpost" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="imagepost">Image</label><br>
                                    <input type="file" name="imagepost" id="imagepost" class="form-control">
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="datefrompost">Publication Date</label><br>
                                            <input id="datefrompost" name="datefrompost" type="date" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="dateuntilpost">Publication Until</label><br>
                                            <input id="dateuntilpost" name="dateuntilpost" type="date" class="form-control">
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                         <div class="form-group">
                             <label for="publishpost">Publish</label>
                             {% if l_chan|length == 0 %}
                                 <p>No channel available for this user</p>
                             {% else %}
                                 {% for chan in l_chan %}
                                     <div class="form-check">
                                      <label class="form-check-label">
                                        <input id="chan_option_{{ chan.id }}" data-namechan="{{ chan.name }} " data-unavailablefields="{{ chan.unavailablefields }}" name="chan_option_{{ chan.id }}" type="checkbox" class="form-check-input checkbox" value="{{ chan.id }}">{{ chan.name }}
                                      </label>
                                    </div>
                                 {% endfor %}
                             {% endif %}
                         </div>

                         <div class="card">
                          <div class="card-header">Status</div>
                          <div class="card-body">Content</div>
                         </div>
                         <div style="margin-top: 1rem; ">

                            <button class="btn btn-primary" formaction="/new" formmethod="post" type="submit">Save</button>
                            <button class="btn btn-success" formaction="/publish" formmethod="post" type="submit">Save & Publish</button>
                            <button class="btn btn-outline-primary" type="reset">Abort</button>
                         </div>

                    </div>

                </div>

              </div>
              {% for chan in l_chan %}
                  <div class="tab-pane container-fluid fade" id="menu{{ chan.id }}">...</div>
              {% endfor %}
            </div>

        </form>
    {% else %}
        Your are not logged in.
    {% endif %}


{% endblock %}

{% block scripts %}
    <script>
        $('input.checkbox').change(function () {
            if ($(this).is(':checked')) {
                $(this).addClass('checked');
                //alert("I'm cheked");
                nameC=$(this).attr('data-namechan');
                fields = $(this).attr('data-unavailablefields');
                split = fields.split(',');
                for(var i = 0; i < split.length; i++) {
                    $("label[for='" + $('#'+split[i].toLowerCase()+'post').attr('id') + "']").append('<a href="#" data-toggle="popover" title="Unavailable field" data-content="This field is unavailable for channel ' + nameC +'"><i class="fas fa-exclamation-circle" style="color:orange"></i></a>');

                }
                $('[data-toggle="popover"]').popover();
                $('#li_'+nameC).show();
            } else {
                $(this).removeClass('checked');
                fields = $(this).attr('data-unavailablefields');
                split = fields.split(',');
                for(var i = 0; i < split.length; i++) {
                    $("label[for='" + $('#'+split[i].toLowerCase()+'post').attr('id') + "'] > a").remove();
                }
                $('#li_'+nameC).hide();
            }
        });
    </script>

{% endblock %}